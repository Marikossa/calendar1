{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"abort-controller/polyfill","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":35,"index":35}}],"key":"Zt445sKJeaqmd3t2yOR0GF+G/L0=","exportNames":["*"],"imports":1}},{"name":"expo-modules-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":36},"end":{"line":2,"column":56,"index":92}}],"key":"fU8WLIPqoAGygnPbZ/QJiQQfXEY=","exportNames":["*"],"imports":1}},{"name":"./ServerRegistrationModule","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":66,"index":159}}],"key":"OTliNP9lxRDJOLdh5XsGIjq12GA=","exportNames":["*"],"imports":1}},{"name":"./TokenEmitter","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":160},"end":{"line":4,"column":54,"index":214}}],"key":"5j/AymtYsxXL7qVrWh9rwW/7ePw=","exportNames":["*"],"imports":1}},{"name":"./getDevicePushTokenAsync","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":215},"end":{"line":5,"column":68,"index":283}}],"key":"XdMNnezmMyUe2eZLOsw/aE7Mhfk=","exportNames":["*"],"imports":1}},{"name":"./utils/updateDevicePushTokenAsync","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":284},"end":{"line":6,"column":120,"index":404}}],"key":"153jXZ66s6HybIv8YrABEWMrDwY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.setAutoServerRegistrationEnabledAsync = setAutoServerRegistrationEnabledAsync;\n  exports.__handlePersistedRegistrationInfoAsync = __handlePersistedRegistrationInfoAsync;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  require(_dependencyMap[1], \"abort-controller/polyfill\");\n  var _expoModulesCore = require(_dependencyMap[2], \"expo-modules-core\");\n  var _ServerRegistrationModule = require(_dependencyMap[3], \"./ServerRegistrationModule\");\n  var ServerRegistrationModule = _interopDefault(_ServerRegistrationModule);\n  var _TokenEmitter = require(_dependencyMap[4], \"./TokenEmitter\");\n  var _getDevicePushTokenAsync = require(_dependencyMap[5], \"./getDevicePushTokenAsync\");\n  var _utilsUpdateDevicePushTokenAsync = require(_dependencyMap[6], \"./utils/updateDevicePushTokenAsync\");\n  var lastAbortController = null;\n  function updatePushTokenAsync(_x) {\n    return _updatePushTokenAsync.apply(this, arguments);\n  }\n  /**\n   * @hidden - the comment is misleading and the purpose of the function needs to be reevaluated\n   *\n   * Sets the registration information so that the device push token gets pushed\n   * to the given registration endpoint\n   * @param enabled\n   */\n  function _updatePushTokenAsync() {\n    _updatePushTokenAsync = (0, _asyncToGenerator.default)(function* (token) {\n      // Abort current update process\n      lastAbortController?.abort();\n      lastAbortController = new AbortController();\n      return yield (0, _utilsUpdateDevicePushTokenAsync.updateDevicePushTokenAsync)(lastAbortController.signal, token);\n    });\n    return _updatePushTokenAsync.apply(this, arguments);\n  }\n  function setAutoServerRegistrationEnabledAsync(_x2) {\n    return _setAutoServerRegistrationEnabledAsync.apply(this, arguments);\n  } // note(Chmiela): This function is exported only for testing purposes.\n  function _setAutoServerRegistrationEnabledAsync() {\n    _setAutoServerRegistrationEnabledAsync = (0, _asyncToGenerator.default)(function* (enabled) {\n      // We are overwriting registration, so we shouldn't let\n      // any pending request complete.\n      lastAbortController?.abort();\n      if (!ServerRegistrationModule.default.setRegistrationInfoAsync) {\n        throw new _expoModulesCore.UnavailabilityError('ServerRegistrationModule', 'setRegistrationInfoAsync');\n      }\n      yield ServerRegistrationModule.default.setRegistrationInfoAsync(enabled ? JSON.stringify({\n        isEnabled: enabled\n      }) : null);\n    });\n    return _setAutoServerRegistrationEnabledAsync.apply(this, arguments);\n  }\n  function __handlePersistedRegistrationInfoAsync(_x3) {\n    return _handlePersistedRegistrationInfoAsync.apply(this, arguments);\n  }\n  function _handlePersistedRegistrationInfoAsync() {\n    _handlePersistedRegistrationInfoAsync = (0, _asyncToGenerator.default)(function* (registrationInfo) {\n      if (!registrationInfo) {\n        // No registration info, nothing to do\n        return;\n      }\n      var registration = null;\n      try {\n        registration = JSON.parse(registrationInfo);\n      } catch (e) {\n        console.warn('[expo-notifications] Error encountered while fetching registration information for auto token updates.', e);\n      }\n      if (!registration?.isEnabled) {\n        // Registration is invalid or not enabled, nothing more to do\n        return;\n      }\n      try {\n        // Since the registration is enabled, fetching a \"new\" device token\n        // shouldn't be a problem.\n        var latestDevicePushToken = yield (0, _getDevicePushTokenAsync.getDevicePushTokenAsync)();\n        yield updatePushTokenAsync(latestDevicePushToken);\n      } catch (e) {\n        console.warn('[expo-notifications] Error encountered while updating server registration with latest device push token.', e);\n      }\n    });\n    return _handlePersistedRegistrationInfoAsync.apply(this, arguments);\n  }\n  if (ServerRegistrationModule.default.getRegistrationInfoAsync) {\n    // A global scope (to get all the updates) device push token\n    // subscription, never cleared.\n    (0, _TokenEmitter.addPushTokenListener)(/*#__PURE__*/function () {\n      var _ref = (0, _asyncToGenerator.default)(function* (token) {\n        try {\n          // Before updating the push token on server we always check if we should\n          // Since modules can't change their method availability while running, we\n          // can assert it's defined.\n          var registrationInfo = yield ServerRegistrationModule.default.getRegistrationInfoAsync();\n          if (!registrationInfo) {\n            // Registration is not enabled\n            return;\n          }\n          var registration = JSON.parse(registrationInfo);\n          if (registration?.isEnabled) {\n            // Dispatch an abortable task to update\n            // registration with new token.\n            yield updatePushTokenAsync(token);\n          }\n        } catch (e) {\n          console.warn('[expo-notifications] Error encountered while updating server registration with latest device push token.', e);\n        }\n      });\n      return function (_x4) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n    // Verify if persisted registration\n    // has successfully uploaded last known\n    // device push token. If not, retry.\n    ServerRegistrationModule.default.getRegistrationInfoAsync().then(__handlePersistedRegistrationInfoAsync);\n  } else {\n    console.warn(`[expo-notifications] Error encountered while fetching auto-registration state, new tokens will not be automatically registered on server.`, new _expoModulesCore.UnavailabilityError('ServerRegistrationModule', 'getRegistrationInfoAsync'));\n  }\n});","lineCount":125,"map":[[12,2,21,0,"exports"],[12,9,21,0],[12,10,21,0,"setAutoServerRegistrationEnabledAsync"],[12,47,21,0],[12,50,21,0,"setAutoServerRegistrationEnabledAsync"],[12,87,21,0],[13,2,31,0,"exports"],[13,9,31,0],[13,10,31,0,"__handlePersistedRegistrationInfoAsync"],[13,48,31,0],[13,51,31,0,"__handlePersistedRegistrationInfoAsync"],[13,89,31,0],[14,2,56,1],[14,6,56,1,"_babelRuntimeHelpersAsyncToGenerator"],[14,42,56,1],[14,45,56,1,"require"],[14,52,56,1],[14,53,56,1,"_dependencyMap"],[14,67,56,1],[15,2,56,1],[15,6,56,1,"_asyncToGenerator"],[15,23,56,1],[15,26,56,1,"_interopDefault"],[15,41,56,1],[15,42,56,1,"_babelRuntimeHelpersAsyncToGenerator"],[15,78,56,1],[16,2,1,0,"require"],[16,9,1,0],[16,10,1,0,"_dependencyMap"],[16,24,1,0],[17,2,2,0],[17,6,2,0,"_expoModulesCore"],[17,22,2,0],[17,25,2,0,"require"],[17,32,2,0],[17,33,2,0,"_dependencyMap"],[17,47,2,0],[18,2,3,0],[18,6,3,0,"_ServerRegistrationModule"],[18,31,3,0],[18,34,3,0,"require"],[18,41,3,0],[18,42,3,0,"_dependencyMap"],[18,56,3,0],[19,2,3,0],[19,6,3,0,"ServerRegistrationModule"],[19,30,3,0],[19,33,3,0,"_interopDefault"],[19,48,3,0],[19,49,3,0,"_ServerRegistrationModule"],[19,74,3,0],[20,2,4,0],[20,6,4,0,"_TokenEmitter"],[20,19,4,0],[20,22,4,0,"require"],[20,29,4,0],[20,30,4,0,"_dependencyMap"],[20,44,4,0],[21,2,5,0],[21,6,5,0,"_getDevicePushTokenAsync"],[21,30,5,0],[21,33,5,0,"require"],[21,40,5,0],[21,41,5,0,"_dependencyMap"],[21,55,5,0],[22,2,6,0],[22,6,6,0,"_utilsUpdateDevicePushTokenAsync"],[22,38,6,0],[22,41,6,0,"require"],[22,48,6,0],[22,49,6,0,"_dependencyMap"],[22,63,6,0],[23,2,7,0],[23,6,7,4,"lastAbortController"],[23,25,7,23],[23,28,7,26],[23,32,7,30],[24,2,7,31],[24,11,8,15,"updatePushTokenAsync"],[24,31,8,35,"updatePushTokenAsync"],[24,32,8,35,"_x"],[24,34,8,35],[25,4,8,35],[25,11,8,35,"_updatePushTokenAsync"],[25,32,8,35],[25,33,8,35,"apply"],[25,38,8,35],[25,45,8,35,"arguments"],[25,54,8,35],[26,2,8,35],[27,2,14,0],[28,0,15,0],[29,0,16,0],[30,0,17,0],[31,0,18,0],[32,0,19,0],[33,0,20,0],[34,2,14,0],[34,11,14,0,"_updatePushTokenAsync"],[34,33,14,0],[35,4,14,0,"_updatePushTokenAsync"],[35,25,14,0],[35,32,14,0,"_asyncToGenerator"],[35,49,14,0],[35,50,14,0,"default"],[35,57,14,0],[35,59,8,0],[35,70,8,36,"token"],[35,75,8,41],[35,77,8,43],[36,6,9,4],[37,6,10,4,"lastAbortController"],[37,25,10,23],[37,27,10,25,"abort"],[37,32,10,30],[37,33,10,31],[37,34,10,32],[38,6,11,4,"lastAbortController"],[38,25,11,23],[38,28,11,26],[38,32,11,30,"AbortController"],[38,47,11,45],[38,48,11,46],[38,49,11,47],[39,6,12,4],[39,19,12,17],[39,23,12,17,"updateDevicePushTokenAsyncWithSignal"],[39,55,12,53],[39,56,12,53,"updateDevicePushTokenAsync"],[39,82,12,53],[39,84,12,54,"lastAbortController"],[39,103,12,73],[39,104,12,74,"signal"],[39,110,12,80],[39,112,12,82,"token"],[39,117,12,87],[39,118,12,88],[40,4,13,0],[40,5,13,1],[41,4,13,1],[41,11,13,1,"_updatePushTokenAsync"],[41,32,13,1],[41,33,13,1,"apply"],[41,38,13,1],[41,45,13,1,"arguments"],[41,54,13,1],[42,2,13,1],[43,2,13,1],[43,11,21,22,"setAutoServerRegistrationEnabledAsync"],[43,48,21,59,"setAutoServerRegistrationEnabledAsync"],[43,49,21,59,"_x2"],[43,52,21,59],[44,4,21,59],[44,11,21,59,"_setAutoServerRegistrationEnabledAsync"],[44,49,21,59],[44,50,21,59,"apply"],[44,55,21,59],[44,62,21,59,"arguments"],[44,71,21,59],[45,2,21,59],[45,4,30,0],[46,2,30,0],[46,11,30,0,"_setAutoServerRegistrationEnabledAsync"],[46,50,30,0],[47,4,30,0,"_setAutoServerRegistrationEnabledAsync"],[47,42,30,0],[47,49,30,0,"_asyncToGenerator"],[47,66,30,0],[47,67,30,0,"default"],[47,74,30,0],[47,76,21,7],[47,87,21,60,"enabled"],[47,94,21,67],[47,96,21,69],[48,6,22,4],[49,6,23,4],[50,6,24,4,"lastAbortController"],[50,25,24,23],[50,27,24,25,"abort"],[50,32,24,30],[50,33,24,31],[50,34,24,32],[51,6,25,4],[51,10,25,8],[51,11,25,9,"ServerRegistrationModule"],[51,35,25,33],[51,36,25,33,"default"],[51,43,25,33],[51,44,25,34,"setRegistrationInfoAsync"],[51,68,25,58],[51,70,25,60],[52,8,26,8],[52,14,26,14],[52,18,26,18,"UnavailabilityError"],[52,34,26,37],[52,35,26,37,"UnavailabilityError"],[52,54,26,37],[52,55,26,38],[52,81,26,64],[52,83,26,66],[52,109,26,92],[52,110,26,93],[53,6,27,4],[54,6,28,4],[54,12,28,10,"ServerRegistrationModule"],[54,36,28,34],[54,37,28,34,"default"],[54,44,28,34],[54,45,28,35,"setRegistrationInfoAsync"],[54,69,28,59],[54,70,28,60,"enabled"],[54,77,28,67],[54,80,28,70,"JSON"],[54,84,28,74],[54,85,28,75,"stringify"],[54,94,28,84],[54,95,28,85],[55,8,28,87,"isEnabled"],[55,17,28,96],[55,19,28,98,"enabled"],[56,6,28,106],[56,7,28,107],[56,8,28,108],[56,11,28,111],[56,15,28,115],[56,16,28,116],[57,4,29,0],[57,5,29,1],[58,4,29,1],[58,11,29,1,"_setAutoServerRegistrationEnabledAsync"],[58,49,29,1],[58,50,29,1,"apply"],[58,55,29,1],[58,62,29,1,"arguments"],[58,71,29,1],[59,2,29,1],[60,2,29,1],[60,11,31,22,"__handlePersistedRegistrationInfoAsync"],[60,49,31,60,"__handlePersistedRegistrationInfoAsync"],[60,50,31,60,"_x3"],[60,53,31,60],[61,4,31,60],[61,11,31,60,"_handlePersistedRegistrationInfoAsync"],[61,48,31,60],[61,49,31,60,"apply"],[61,54,31,60],[61,61,31,60,"arguments"],[61,70,31,60],[62,2,31,60],[63,2,31,60],[63,11,31,60,"_handlePersistedRegistrationInfoAsync"],[63,49,31,60],[64,4,31,60,"_handlePersistedRegistrationInfoAsync"],[64,41,31,60],[64,48,31,60,"_asyncToGenerator"],[64,65,31,60],[64,66,31,60,"default"],[64,73,31,60],[64,75,31,7],[64,86,31,61,"registrationInfo"],[64,102,31,77],[64,104,31,79],[65,6,32,4],[65,10,32,8],[65,11,32,9,"registrationInfo"],[65,27,32,25],[65,29,32,27],[66,8,33,8],[67,8,34,8],[68,6,35,4],[69,6,36,4],[69,10,36,8,"registration"],[69,22,36,20],[69,25,36,23],[69,29,36,27],[70,6,37,4],[70,10,37,8],[71,8,38,8,"registration"],[71,20,38,20],[71,23,38,23,"JSON"],[71,27,38,27],[71,28,38,28,"parse"],[71,33,38,33],[71,34,38,34,"registrationInfo"],[71,50,38,50],[71,51,38,51],[72,6,39,4],[72,7,39,5],[72,8,40,4],[72,15,40,11,"e"],[72,16,40,12],[72,18,40,14],[73,8,41,8,"console"],[73,15,41,15],[73,16,41,16,"warn"],[73,20,41,20],[73,21,41,21],[73,125,41,125],[73,127,41,127,"e"],[73,128,41,128],[73,129,41,129],[74,6,42,4],[75,6,43,4],[75,10,43,8],[75,11,43,9,"registration"],[75,23,43,21],[75,25,43,23,"isEnabled"],[75,34,43,32],[75,36,43,34],[76,8,44,8],[77,8,45,8],[78,6,46,4],[79,6,47,4],[79,10,47,8],[80,8,48,8],[81,8,49,8],[82,8,50,8],[82,12,50,14,"latestDevicePushToken"],[82,33,50,35],[82,42,50,44],[82,46,50,44,"getDevicePushTokenAsync"],[82,70,50,67],[82,71,50,67,"getDevicePushTokenAsync"],[82,94,50,67],[82,96,50,68],[82,97,50,69],[83,8,51,8],[83,14,51,14,"updatePushTokenAsync"],[83,34,51,34],[83,35,51,35,"latestDevicePushToken"],[83,56,51,56],[83,57,51,57],[84,6,52,4],[84,7,52,5],[84,8,53,4],[84,15,53,11,"e"],[84,16,53,12],[84,18,53,14],[85,8,54,8,"console"],[85,15,54,15],[85,16,54,16,"warn"],[85,20,54,20],[85,21,54,21],[85,127,54,127],[85,129,54,129,"e"],[85,130,54,130],[85,131,54,131],[86,6,55,4],[87,4,56,0],[87,5,56,1],[88,4,56,1],[88,11,56,1,"_handlePersistedRegistrationInfoAsync"],[88,48,56,1],[88,49,56,1,"apply"],[88,54,56,1],[88,61,56,1,"arguments"],[88,70,56,1],[89,2,56,1],[90,2,57,0],[90,6,57,4,"ServerRegistrationModule"],[90,30,57,28],[90,31,57,28,"default"],[90,38,57,28],[90,39,57,29,"getRegistrationInfoAsync"],[90,63,57,53],[90,65,57,55],[91,4,58,4],[92,4,59,4],[93,4,60,4],[93,8,60,4,"addPushTokenListener"],[93,21,60,24],[93,22,60,24,"addPushTokenListener"],[93,42,60,24],[94,6,60,24],[94,10,60,24,"_ref"],[94,14,60,24],[94,21,60,24,"_asyncToGenerator"],[94,38,60,24],[94,39,60,24,"default"],[94,46,60,24],[94,48,60,25],[94,59,60,32,"token"],[94,64,60,37],[94,66,60,42],[95,8,61,8],[95,12,61,12],[96,10,62,12],[97,10,63,12],[98,10,64,12],[99,10,65,12],[99,14,65,18,"registrationInfo"],[99,30,65,34],[99,39,65,43,"ServerRegistrationModule"],[99,63,65,67],[99,64,65,67,"default"],[99,71,65,67],[99,72,65,68,"getRegistrationInfoAsync"],[99,96,65,92],[99,97,65,93],[99,98,65,94],[100,10,66,12],[100,14,66,16],[100,15,66,17,"registrationInfo"],[100,31,66,33],[100,33,66,35],[101,12,67,16],[102,12,68,16],[103,10,69,12],[104,10,70,12],[104,14,70,18,"registration"],[104,26,70,30],[104,29,70,33,"JSON"],[104,33,70,37],[104,34,70,38,"parse"],[104,39,70,43],[104,40,70,44,"registrationInfo"],[104,56,70,60],[104,57,70,61],[105,10,71,12],[105,14,71,16,"registration"],[105,26,71,28],[105,28,71,30,"isEnabled"],[105,37,71,39],[105,39,71,41],[106,12,72,16],[107,12,73,16],[108,12,74,16],[108,18,74,22,"updatePushTokenAsync"],[108,38,74,42],[108,39,74,43,"token"],[108,44,74,48],[108,45,74,49],[109,10,75,12],[110,8,76,8],[110,9,76,9],[110,10,77,8],[110,17,77,15,"e"],[110,18,77,16],[110,20,77,18],[111,10,78,12,"console"],[111,17,78,19],[111,18,78,20,"warn"],[111,22,78,24],[111,23,78,25],[111,129,78,131],[111,131,78,133,"e"],[111,132,78,134],[111,133,78,135],[112,8,79,8],[113,6,80,4],[113,7,80,5],[114,6,80,5],[114,23,80,5,"_x4"],[114,26,80,5],[115,8,80,5],[115,15,80,5,"_ref"],[115,19,80,5],[115,20,80,5,"apply"],[115,25,80,5],[115,32,80,5,"arguments"],[115,41,80,5],[116,6,80,5],[117,4,80,5],[117,8,80,6],[118,4,81,4],[119,4,82,4],[120,4,83,4],[121,4,84,4,"ServerRegistrationModule"],[121,28,84,28],[121,29,84,28,"default"],[121,36,84,28],[121,37,84,29,"getRegistrationInfoAsync"],[121,61,84,53],[121,62,84,54],[121,63,84,55],[121,64,84,56,"then"],[121,68,84,60],[121,69,84,61,"__handlePersistedRegistrationInfoAsync"],[121,107,84,99],[121,108,84,100],[122,2,85,0],[122,3,85,1],[122,9,86,5],[123,4,87,4,"console"],[123,11,87,11],[123,12,87,12,"warn"],[123,16,87,16],[123,17,87,17],[123,156,87,156],[123,158,87,158],[123,162,87,162,"UnavailabilityError"],[123,178,87,181],[123,179,87,181,"UnavailabilityError"],[123,198,87,181],[123,199,87,182],[123,225,87,208],[123,227,87,210],[123,253,87,236],[123,254,87,237],[123,255,87,238],[124,2,88,0],[125,0,88,1],[125,3]],"functionMap":{"names":["<global>","updatePushTokenAsync","setAutoServerRegistrationEnabledAsync","__handlePersistedRegistrationInfoAsync","addPushTokenListener$argument_0"],"mappings":"AAA;ACO;CDK;OEQ;CFQ;OGE;CHyB;yBII;KJoB"},"hasCjsExports":false},"type":"js/module"}]}